# Default values for go-ai-agent
# This is a YAML-formatted file.

# -----------------------------------------------------------------------------
# Global settings
# -----------------------------------------------------------------------------
nameOverride: ""
fullnameOverride: ""

# -----------------------------------------------------------------------------
# Image settings
# -----------------------------------------------------------------------------
image:
  repository: ghcr.io/hassan123789/go-ai-agent
  tag: "latest"
  pullPolicy: IfNotPresent

imagePullSecrets: []

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -----------------------------------------------------------------------------
# Pod settings
# -----------------------------------------------------------------------------
replicaCount: 2

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Resources
# -----------------------------------------------------------------------------
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# -----------------------------------------------------------------------------
# Service
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 80
  targetPort: 8080

# -----------------------------------------------------------------------------
# Ingress
# -----------------------------------------------------------------------------
ingress:
  enabled: false
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
  hosts:
    - host: ai-agent.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: go-ai-agent-tls
  #    hosts:
  #      - ai-agent.example.com

# -----------------------------------------------------------------------------
# Autoscaling
# -----------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Health checks
# -----------------------------------------------------------------------------
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 30

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10

# -----------------------------------------------------------------------------
# Node selection
# -----------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}

# -----------------------------------------------------------------------------
# Application configuration
# -----------------------------------------------------------------------------
config:
  serverPort: "8080"
  logLevel: "info"
  llmProvider: "openai"
  llmModel: "gpt-4o-mini"
  llmMaxTokens: "2048"
  ollamaBaseUrl: "http://ollama:11434/v1"
  agentMaxIterations: "10"
  agentTimeoutSeconds: "120"

# -----------------------------------------------------------------------------
# Secrets (use external secrets in production!)
# -----------------------------------------------------------------------------
secrets:
  openaiApiKey: ""
  anthropicApiKey: ""
  databaseUrl: ""

# -----------------------------------------------------------------------------
# PostgreSQL (using Bitnami chart)
# -----------------------------------------------------------------------------
postgresql:
  enabled: true
  auth:
    username: postgres
    password: postgres
    database: aiagent
  primary:
    persistence:
      size: 10Gi
    initdb:
      scripts:
        init.sql: |
          CREATE EXTENSION IF NOT EXISTS vector;
          CREATE TABLE IF NOT EXISTS embeddings (
              id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
              content TEXT NOT NULL,
              embedding vector(1536),
              metadata JSONB DEFAULT '{}',
              namespace VARCHAR(255) DEFAULT 'default',
              created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
          );
          CREATE INDEX IF NOT EXISTS embeddings_embedding_idx
          ON embeddings USING ivfflat (embedding vector_cosine_ops);
